<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Racer: Work, Energy & Power Lab</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            overflow: hidden;
            height: 100vh;
            font-size: 16px;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 8px 12px;
            background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: start;
        }

        .speed-display {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            padding: 12px 20px;
            border-radius: 25px;
            border: 3px solid #ffff00;
            box-shadow: 0 0 25px rgba(255, 107, 53, 0.6);
            font-weight: 900;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            text-align: center;
            min-width: 140px;
        }

        .energy-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(0,0,0,0.8);
            padding: 16px;
            border-radius: 12px;
            border: 3px solid #00ffff;
            min-width: 280px;
            max-width: 320px;
        }

        .energy-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 700;
        }

        .energy-label {
            min-width: 45px;
            font-size: 16px;
        }

        .bar {
            flex: 1;
            height: 16px;
            border: 2px solid #fff;
            border-radius: 8px;
            overflow: hidden;
            background: #333;
            min-width: 120px;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 6px;
        }

        .kinetic-bar { background: linear-gradient(90deg, #ff0080, #ff4040); }
        .potential-bar { background: linear-gradient(90deg, #0080ff, #40ff40); }
        .power-bar { background: linear-gradient(90deg, #ffff00, #ff8000); }

        .energy-value {
            min-width: 60px;
            text-align: right;
            font-size: 14px;
        }

        .physics-display {
            font-size: 16px;
            background: rgba(0,0,0,0.8);
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            min-width: 180px;
            line-height: 1.4;
        }

        .physics-display div {
            margin-bottom: 4px;
        }

        .education-panel {
            position: absolute;
            left: 12px;
            bottom: 120px;
            background: rgba(0,0,0,0.9);
            border: 3px solid #ff00ff;
            border-radius: 12px;
            padding: 16px;
            max-width: 350px;
            font-size: 14px;
            line-height: 1.5;
            z-index: 90;
            transition: transform 0.3s ease;
        }

        .education-header {
            color: #ff00ff;
            font-weight: 900;
            font-size: 18px;
            margin-bottom: 12px;
            text-align: center;
        }

        .concept-explanation {
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(255, 0, 255, 0.1);
            border-radius: 6px;
        }

        .formula {
            background: rgba(255, 255, 0, 0.2);
            padding: 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
            margin: 4px 0;
        }

        .learning-tip {
            background: rgba(0, 255, 255, 0.1);
            padding: 8px;
            border-radius: 6px;
            font-size: 13px;
            border-left: 3px solid #00ffff;
            margin-top: 8px;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 100;
        }

        .control-btn {
            background: linear-gradient(135deg, #4a4a8a, #6a6aaa);
            border: 3px solid #ffffff;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            color: white;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            font-family: 'Orbitron', monospace;
            touch-action: manipulation;
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(0,0,0,0.7);
        }

        .control-btn.power-up {
            background: linear-gradient(135deg, #ff4040, #ff8040);
            border-color: #ffff00;
            box-shadow: 0 5px 15px rgba(255, 64, 64, 0.5);
        }

        .control-btn.power-down {
            background: linear-gradient(135deg, #4040ff, #8040ff);
            border-color: #00ffff;
            box-shadow: 0 5px 15px rgba(64, 64, 255, 0.5);
        }

        .toggle-education {
            position: absolute;
            right: 12px;
            bottom: 120px;
            background: linear-gradient(135deg, #ff00ff, #8000ff);
            border: 2px solid #fff;
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            z-index: 100;
            touch-action: manipulation;
        }

        .game-svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .terrain-grass { fill: #2d5016; }
        .terrain-dirt { fill: #8b4513; }
        .terrain-ice { fill: #87ceeb; }

        .car-body { fill: #ff0040; stroke: #fff; stroke-width: 2; }
        .car-detail { fill: #ffff00; }
        .wheel { fill: #333; stroke: #666; stroke-width: 1; }

        .opponent-car { fill: #0080ff; }

        .track-marker {
            fill: none;
            stroke: #ffff00;
            stroke-width: 3;
            stroke-dasharray: 20,10;
            opacity: 0.8;
        }

        .particle {
            fill: #ff8040;
            opacity: 0.8;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .speed-boost {
            animation: pulse 0.5s infinite;
        }

        .game-title {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            font-weight: 900;
            color: #ffff00;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.8);
            z-index: 200;
            opacity: 0;
            transition: opacity 1s ease;
            text-align: center;
            line-height: 1.2;
        }

        .game-subtitle {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: 700;
            color: #00ffff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 200;
            opacity: 0;
            transition: opacity 1s ease;
            text-align: center;
        }

        .show-title {
            opacity: 1;
        }

        .hidden {
            transform: translateX(-100%);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .hud {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 8px;
                padding: 8px;
            }
            
            .energy-panel {
                min-width: 100%;
                max-width: 100%;
                order: 1;
            }
            
            .speed-display {
                order: 2;
                justify-self: center;
                font-size: 18px;
                padding: 10px 16px;
                min-width: 120px;
            }
            
            .physics-display {
                order: 3;
                min-width: 100%;
                font-size: 14px;
            }
            
            .control-btn {
                width: 70px;
                height: 70px;
                font-size: 14px;
            }
            
            .education-panel {
                left: 8px;
                right: 8px;
                bottom: 110px;
                max-width: none;
                font-size: 13px;
            }
            
            .toggle-education {
                right: 8px;
                bottom: 110px;
                font-size: 12px;
                padding: 8px 12px;
            }

            .game-title {
                font-size: 28px;
            }

            .game-subtitle {
                font-size: 16px;
            }

            .energy-bar {
                font-size: 14px;
                gap: 8px;
            }

            .energy-label {
                min-width: 35px;
                font-size: 14px;
            }

            .bar {
                min-width: 80px;
                height: 14px;
            }

            .energy-value {
                min-width: 50px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .hud {
                padding: 6px;
            }

            .education-panel {
                font-size: 12px;
                padding: 12px;
            }

            .control-btn {
                width: 60px;
                height: 60px;
                font-size: 12px;
            }

            .speed-display {
                font-size: 16px;
                padding: 8px 12px;
            }

            .energy-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 4px;
            }

            .bar {
                min-width: 100%;
            }

            .energy-value {
                text-align: center;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-title" id="gameTitle">PHYSICS RACER</div>
        <div class="game-subtitle" id="gameSubtitle">Learn Work, Energy & Power!</div>
        
        <div class="hud">
            <div class="speed-display">
                <div>SPEED: <span id="speedValue">0</span> m/s</div>
            </div>
            
            <div class="energy-panel">
                <div class="energy-bar">
                    <span class="energy-label">KE:</span>
                    <div class="bar">
                        <div class="bar-fill kinetic-bar" id="kineticBar" style="width: 0%"></div>
                    </div>
                    <span class="energy-value" id="kineticValue">0 J</span>
                </div>
                <div class="energy-bar">
                    <span class="energy-label">PE:</span>
                    <div class="bar">
                        <div class="bar-fill potential-bar" id="potentialBar" style="width: 0%"></div>
                    </div>
                    <span class="energy-value" id="potentialValue">0 J</span>
                </div>
                <div class="energy-bar">
                    <span class="energy-label">PWR:</span>
                    <div class="bar">
                        <div class="bar-fill power-bar" id="powerBar" style="width: 50%"></div>
                    </div>
                    <span class="energy-value" id="powerValue">5 kW</span>
                </div>
            </div>

            <div class="physics-display">
                <div><strong>Height:</strong> <span id="heightValue">0</span> m</div>
                <div><strong>Force:</strong> <span id="forceValue">0</span> N</div>
                <div><strong>Work:</strong> <span id="workValue">0</span> J</div>
                <div><strong>Surface:</strong> <span id="terrainType">GRASS</span></div>
            </div>
        </div>

        <div class="education-panel" id="educationPanel">
            <div class="education-header">🎓 PHYSICS CONCEPTS</div>
            
            <div class="concept-explanation">
                <strong>Kinetic Energy (KE):</strong> Energy of motion
                <div class="formula">KE = ½mv² (½ × mass × velocity²)</div>
            </div>
            
            <div class="concept-explanation">
                <strong>Potential Energy (PE):</strong> Stored energy due to position
                <div class="formula">PE = mgh (mass × gravity × height)</div>
            </div>
            
            <div class="concept-explanation">
                <strong>Power (PWR):</strong> Rate of energy transfer
                <div class="formula">P = W/t (Work ÷ time) or P = F×v</div>
            </div>

            <div class="learning-tip">
                <strong>💡 Try This:</strong> Notice how increasing power affects your acceleration! Watch how energy transforms between kinetic and potential as you go up and down hills.
            </div>
        </div>

        <button class="toggle-education" id="toggleEducation">📚 Hide Guide</button>

        <svg class="game-svg" viewBox="0 0 1200 600" id="gameSvg">
            <!-- Background -->
            <defs>
                <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#98FB98;stop-opacity:1" />
                </linearGradient>
                
                <linearGradient id="hillGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#228B22;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#006400;stop-opacity:1" />
                </linearGradient>

                <filter id="glow">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                    <feMerge> 
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/> 
                    </feMerge>
                </filter>
            </defs>

            <!-- Sky -->
            <rect width="1200" height="300" fill="url(#skyGradient)"/>

            <!-- Hills and Track -->
            <path id="trackPath" d="M 0,400 Q 200,350 400,380 Q 600,320 800,360 Q 1000,300 1200,340" 
                  fill="none" stroke="#666" stroke-width="40" opacity="0.3"/>
                  
            <path id="terrainPath" d="M 0,400 Q 200,350 400,380 Q 600,320 800,360 Q 1000,300 1200,340 L 1200,600 L 0,600 Z" 
                  fill="url(#hillGradient)"/>

            <!-- Track markers -->
            <path class="track-marker" d="M 0,400 Q 200,350 400,380 Q 600,320 800,360 Q 1000,300 1200,340"/>

            <!-- Terrain sections -->
            <rect x="0" y="375" width="300" height="25" class="terrain-grass"/>
            <rect x="300" y="355" width="200" height="25" class="terrain-dirt"/>
            <rect x="500" y="345" width="200" height="25" class="terrain-ice"/>
            <rect x="700" y="335" width="300" height="25" class="terrain-grass"/>
            <rect x="1000" y="275" width="200" height="25" class="terrain-dirt"/>

            <!-- Player car -->
            <g id="playerCar" transform="translate(100, 380)">
                <!-- Car body -->
                <ellipse class="car-body" cx="0" cy="0" rx="25" ry="12"/>
                <rect class="car-detail" x="-20" y="-8" width="40" height="4" rx="2"/>
                <rect class="car-detail" x="-15" y="-4" width="30" height="3" rx="2"/>
                <!-- Wheels -->
                <circle class="wheel" cx="-15" cy="8" r="6"/>
                <circle class="wheel" cx="15" cy="8" r="6"/>
                <!-- Engine glow -->
                <circle cx="-25" cy="0" r="3" fill="#ff8040" opacity="0.8" filter="url(#glow)"/>
            </g>

            <!-- Opponent car -->
            <g id="opponentCar" transform="translate(50, 385)">
                <ellipse class="opponent-car" cx="0" cy="0" rx="22" ry="10" stroke="#fff" stroke-width="2"/>
                <rect fill="#ffff00" x="-18" y="-6" width="36" height="3" rx="2"/>
                <circle class="wheel" cx="-12" cy="6" r="5"/>
                <circle class="wheel" cx="12" cy="6" r="5"/>
            </g>

            <!-- Particles -->
            <g id="particles"></g>
        </svg>

        <div class="controls">
            <button class="control-btn power-down" id="powerDown">PWR-</button>
            <button class="control-btn power-up" id="powerUp">PWR+</button>
        </div>
    </div>

    <script>
        class PhysicsRacer {
            constructor() {
                this.car = {
                    x: 100,
                    y: 380,
                    velocity: 0,
                    mass: 800, // kg
                    power: 5000, // watts
                    maxPower: 10000,
                    minPower: 1000
                };
                
                this.opponent = {
                    x: 50,
                    y: 385,
                    velocity: 8 // constant speed
                };

                this.physics = {
                    gravity: 10,
                    trackLength: 1200,
                    height: 0,
                    work: 0,
                    force: 0
                };

                this.terrainTypes = [
                    {name: 'GRASS', friction: 0.7, start: 0, end: 300},
                    {name: 'DIRT', friction: 0.9, start: 300, end: 500},
                    {name: 'ICE', friction: 0.3, start: 500, end: 700},
                    {name: 'GRASS', friction: 0.7, start: 700, end: 1000},
                    {name: 'DIRT', friction: 0.9, start: 1000, end: 1200}
                ];

                this.gameState = {
                    running: false,
                    distance: 0,
                    time: 0,
                    educationVisible: true
                };

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.showTitle();
                setTimeout(() => this.startGame(), 3000);
            }

            showTitle() {
                const title = document.getElementById('gameTitle');
                const subtitle = document.getElementById('gameSubtitle');
                title.classList.add('show-title');
                setTimeout(() => {
                    subtitle.classList.add('show-title');
                }, 500);
                setTimeout(() => {
                    title.classList.remove('show-title');
                    subtitle.classList.remove('show-title');
                }, 2500);
            }

            setupEventListeners() {
                document.getElementById('powerUp').addEventListener('click', () => this.adjustPower(1000));
                document.getElementById('powerDown').addEventListener('click', () => this.adjustPower(-1000));
                
                // Education panel toggle
                document.getElementById('toggleEducation').addEventListener('click', () => this.toggleEducation());
                
                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'ArrowUp':
                        case 'w':
                        case 'W':
                            e.preventDefault();
                            this.adjustPower(1000);
                            break;
                        case 'ArrowDown':
                        case 's':
                        case 'S':
                            e.preventDefault();
                            this.adjustPower(-1000);
                            break;
                        case 'h':
                        case 'H':
                            this.toggleEducation();
                            break;
                    }
                });

                // Enhanced touch controls for mobile
                this.setupTouchControls();
            }

            setupTouchControls() {
                const powerUpBtn = document.getElementById('powerUp');
                const powerDownBtn = document.getElementById('powerDown');
                
                // Prevent zooming and scrolling on button touch
                [powerUpBtn, powerDownBtn].forEach(btn => {
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        btn.classList.add('speed-boost');
                    }, { passive: false });
                    
                    btn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        btn.classList.remove('speed-boost');
                    }, { passive: false });
                });
                
                powerUpBtn.addEventListener('touchstart', () => this.adjustPower(1000));
                powerDownBtn.addEventListener('touchstart', () => this.adjustPower(-1000));
            }

            toggleEducation() {
                const panel = document.getElementById('educationPanel');
                const button = document.getElementById('toggleEducation');
                
                this.gameState.educationVisible = !this.gameState.educationVisible;
                
                if (this.gameState.educationVisible) {
                    panel.classList.remove('hidden');
                    button.textContent = '📚 Hide Guide';
                } else {
                    panel.classList.add('hidden');
                    button.textContent = '📚 Show Guide';
                }
            }

            adjustPower(delta) {
                this.car.power = Math.max(this.car.minPower, 
                    Math.min(this.car.maxPower, this.car.power + delta));
                this.createParticles();
                
                // Provide educational feedback
                if (delta > 0 && this.car.power === this.car.maxPower) {
                    this.showPhysicsTip("Maximum power reached! Notice how acceleration decreases at higher speeds due to P = F×v relationship.");
                } else if (delta < 0 && this.car.power === this.car.minPower) {
                    this.showPhysicsTip("Minimum power reached! You're still moving due to kinetic energy, but you'll slow down due to friction.");
                }
            }

            showPhysicsTip(message) {
                // Could implement a temporary tooltip system here
                console.log("Physics Tip:", message);
            }

            getCurrentTerrain() {
                for (let terrain of this.terrainTypes) {
                    if (this.car.x >= terrain.start && this.car.x < terrain.end) {
                        return terrain;
                    }
                }
                return this.terrainTypes[0];
            }

            calculateHeight() {
                // Simulate hill profile
                const normalizedX = this.car.x / this.physics.trackLength;
                return 50 * Math.sin(normalizedX * Math.PI * 2) + 100;
            }

            updatePhysics() {
                const terrain = this.getCurrentTerrain();
                this.physics.height = this.calculateHeight();
                
                // Calculate force from power: P = F * v, so F = P / v
                if (this.car.velocity > 0.1) {
                    this.physics.force = this.car.power / this.car.velocity;
                } else {
                    this.physics.force = this.car.power / 0.1; // Avoid division by zero
                }

                // Apply terrain friction
                const frictionForce = this.physics.force * terrain.friction;
                
                // Calculate acceleration: F = ma, so a = F/m
                const acceleration = frictionForce / this.car.mass;
                
                // Update velocity and position
                this.car.velocity += acceleration * 0.016; // 60 FPS
                this.car.velocity = Math.max(0, Math.min(25, this.car.velocity)); // Speed limits
                
                this.car.x += this.car.velocity * 0.5; // Scale for visual effect
                
                // Calculate work done: W = F * d
                const distance = this.car.velocity * 0.5 * 0.016;
                this.physics.work += frictionForce * distance;
                
                // Update car Y position based on track
                this.car.y = this.getTrackY(this.car.x);
                
                // Update opponent
                this.opponent.x += this.opponent.velocity * 0.5;
                this.opponent.y = this.getTrackY(this.opponent.x);
                
                // Reset positions if off track
                if (this.car.x > this.physics.trackLength) {
                    this.car.x = 0;
                    this.physics.work = 0; // Reset work counter
                }
                if (this.opponent.x > this.physics.trackLength) this.opponent.x = 0;
            }

            getTrackY(x) {
                // Simulate the track curve
                const normalizedX = x / this.physics.trackLength;
                return 380 - 30 * Math.sin(normalizedX * Math.PI * 2);
            }

            updateDisplay() {
                // Update HUD values with proper formatting
                document.getElementById('speedValue').textContent = this.car.velocity.toFixed(1);
                document.getElementById('heightValue').textContent = (this.physics.height / 10).toFixed(1);
                document.getElementById('forceValue').textContent = this.physics.force.toFixed(0);
                document.getElementById('workValue').textContent = (this.physics.work / 1000).toFixed(1) + 'k';
                document.getElementById('terrainType').textContent = this.getCurrentTerrain().name;

                // Calculate energies
                const kineticEnergy = 0.5 * this.car.mass * Math.pow(this.car.velocity, 2);
                const potentialEnergy = this.car.mass * this.physics.gravity * (this.physics.height / 10);
                
                // Format energy displays
                if (kineticEnergy >= 1000) {
                    document.getElementById('kineticValue').textContent = (kineticEnergy / 1000).toFixed(1) + ' kJ';
                } else {
                    document.getElementById('kineticValue').textContent = kineticEnergy.toFixed(0) + ' J';
                }
                
                if (potentialEnergy >= 1000) {
                    document.getElementById('potentialValue').textContent = (potentialEnergy / 1000).toFixed(1) + ' kJ';
                } else {
                    document.getElementById('potentialValue').textContent = potentialEnergy.toFixed(0) + ' J';
                }
                
                document.getElementById('powerValue').textContent = (this.car.power / 1000).toFixed(1) + ' kW';

                // Update energy bars
                const maxEnergy = 50000; // Max energy for bar scaling
                document.getElementById('kineticBar').style.width = `${Math.min(100, (kineticEnergy / maxEnergy) * 100)}%`;
                document.getElementById('potentialBar').style.width = `${Math.min(100, (potentialEnergy / maxEnergy) * 100)}%`;
                document.getElementById('powerBar').style.width = `${(this.car.power / this.car.maxPower) * 100}%`;

                // Update car positions
                document.getElementById('playerCar').setAttribute('transform', 
                    `translate(${this.car.x}, ${this.car.y})`);
                document.getElementById('opponentCar').setAttribute('transform', 
                    `translate(${this.opponent.x}, ${this.opponent.y})`);
            }

            createParticles() {
                const particlesGroup = document.getElementById('particles');
                
                // Create engine exhaust particles
                for (let i = 0; i < 3; i++) {
                    const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    particle.setAttribute('class', 'particle');
                    particle.setAttribute('cx', this.car.x - 30);
                    particle.setAttribute('cy', this.car.y + Math.random() * 10 - 5);
                    particle.setAttribute('r', Math.random() * 3 + 1);
                    particle.setAttribute('opacity', 0.8);
                    
                    particlesGroup.appendChild(particle);
                    
                    // Animate particle
                    setTimeout(() => {
                        particle.setAttribute('opacity', 0);
                        setTimeout(() => particle.remove(), 300);
                    }, 100 + i * 50);
                }
            }

            startGame() {
                this.gameState.running = true;
                this.gameLoop();
            }

            gameLoop() {
                if (!this.gameState.running) return;
                
                this.updatePhysics();
                this.updateDisplay();
                
                // Continue game loop
                requestAnimationFrame(() => this.gameLoop());
            }
        }

        // Initialize game when page loads
        window.addEventListener('load', () => {
            new PhysicsRacer();
        });

        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
</body>
</html>
